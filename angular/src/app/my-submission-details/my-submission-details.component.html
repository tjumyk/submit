<app-error-message [error]="error"></app-error-message>
<app-success-message [success]="success"></app-success-message>
<div class="ui text loader active" *ngIf="loadingSubmission">Loading submission info...</div>

<div *ngIf="submission">
  <div class="ui breadcrumb">
    <a class="section" routerLink="..">My Submissions</a>
    <i class="icon right angle divider"></i>
    <div class="active section">Submission {{submission.id}}</div>
  </div>

  <div class="ui segment">
    <div class="ui list horizontal">
      <div class="item">
        <div class="header">Submitted At</div>
        {{ submission.created_at | date: 'medium' }} ({{createdFromNow}})
      </div>
    </div>
  </div>

  <h4 class="ui header">
    <i class="icon copy outline"></i>
    Files
  </h4>
  <table class="ui table unstackable">
    <thead><tr><th>#</th><th>ID</th><th>Name</th><th>Size</th><th>MD5 Hash</th><th>Operations</th></tr></thead>
    <tbody>
    <tr *ngFor="let file of submission.files; index as i">
      <td>{{i+1}}</td>
      <td>{{file.id}}</td>
      <td>{{file.requirement.name}}</td>
      <td>{{file.size | size}}</td>
      <td><span [attr.data-tooltip]="file.md5" data-position="bottom center">{{file.md5|slice:0:6}}</span></td>
      <td>
        <a class="ui mini icon button" href="api/my-submissions/{{submissionId}}/files/{{file.id}}/download"
           title="Download">
          <i class="icon download"></i>
        </a>
      </td>
    </tr>
    </tbody>
  </table>

  <ng-container *ngIf="task.evaluation_method=='auto_test'">
    <h4 class="ui header">
      <i class="icon terminal"></i>
      Auto Tests
    </h4>

    <ng-container *ngIf="autoTests">
      <div class="ui segment" *ngFor="let test of autoTests">
        <div class="ui list horizontal">
          <div class="item">
            <div class="header">ID</div>
            {{test.id}}
          </div>
          <div class="item">
            <div class="header">Worker</div>
            <span *ngIf="test.hostname; else noWorker">{{test.hostname}}</span>
            <ng-template #noWorker>(None)</ng-template>
          </div>
          <div class="item">
            <div class="header">State</div>
            <span [ngStyle]="{'color': getStatusColor(test.final_state || test.state)}">
            {{test.final_state || test.state}}
          </span>
          </div>
          <div class="item">
            <div class="header">Created At</div>
            {{test.created_at | date: 'medium'}}
          </div>
          <div class="item">
            <div class="header">Started At</div>
            <span *ngIf="test.started_at; else noStartTime">{{test.started_at | date: 'medium'}}</span>
            <ng-template #noStartTime>N/A</ng-template>
          </div>
          <div class="item">
            <div class="header">Stopped At</div>
            <span *ngIf="test.stopped_at; else noStopTime">{{test.stopped_at | date: 'medium'}}</span>
            <ng-template #noStopTime>N/A</ng-template>
          </div>
        </div>

        <ng-container *ngIf="(test.final_state || test.state) == 'FAILURE' || (test.final_state || test.state) == 'SUCCESS'">
          <div *ngIf="test.exception_class">
            <div class="ui divider horizontal">Exception</div>
            <p><b>{{test.exception_class}}</b> {{test.exception_message}}</p>
          </div>
          <div *ngIf="test.result != null">
            <div class="ui divider horizontal">Result</div>
            <pre class="code">{{test.result|json}}</pre>
          </div>
        </ng-container>
      </div>
    </ng-container>
  </ng-container>
</div>
